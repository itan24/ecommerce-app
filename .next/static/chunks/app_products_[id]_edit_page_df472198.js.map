{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Programming/NodeJs%20Learning/ecommerce-app/app/products/%5Bid%5D/edit/page.js"],"sourcesContent":["'use client';\nimport { useState, useEffect, use } from 'react';\nimport axios from 'axios';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport Navbar from '../components/Navbar';\n\nexport default function EditProduct({ params }) {\n  const [name, setName] = useState('');\n  const [price, setPrice] = useState('');\n  const [stock, setStock] = useState('');\n  const [description, setDescription] = useState('');\n  const [images, setImages] = useState([]);\n  const [newImages, setNewImages] = useState([]);\n  const [previews, setPreviews] = useState([]);\n  const [prominentImageIndex, setProminentImageIndex] = useState(0);\n  const [message, setMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const router = useRouter();\n  const { id: productId } = use(params);\n\n  useEffect(() => {\n    const fetchProduct = async () => {\n      try {\n        const res = await axios.get(`/api/products/${productId}`);\n        const product = res.data;\n        setName(product.name);\n        setPrice(product.price);\n        setStock(product.stock);\n        setDescription(product.description);\n        setImages(product.images);\n        setProminentImageIndex(product.images.findIndex(img => img.isProminent) || 0);\n        setPreviews(product.images.map(img => img.url));\n      } catch (err) {\n        setMessage('Failed to fetch product details');\n      }\n    };\n    fetchProduct();\n  }, [productId]);\n\n  const handleImageChange = (e) => {\n    const files = Array.from(e.target.files).slice(0, 5 - images.length);\n    setNewImages(files);\n    const newPreviews = files.map(file => URL.createObjectURL(file));\n    setPreviews([...previews, ...newPreviews]);\n  };\n\n  const handleDeleteImage = (index) => {\n    const updatedImages = images.filter((_, i) => i !== index);\n    const updatedPreviews = previews.filter((_, i) => i !== index);\n    setImages(updatedImages);\n    setPreviews(updatedPreviews);\n    if (prominentImageIndex === index) {\n      setProminentImageIndex(0);\n    } else if (prominentImageIndex > index) {\n      setProminentImageIndex(prominentImageIndex - 1);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!name || !price || !stock || !description) {\n      setMessage('Please fill in all fields');\n      return;\n    }\n    if (price <= 0 || stock < 0) {\n      setMessage('Price must be greater than 0 and stock cannot be negative');\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        router.push('/login');\n        return;\n      }\n\n      const formData = new FormData();\n      formData.append('name', name);\n      formData.append('price', price);\n      formData.append('stock', stock);\n      formData.append('description', description);\n      formData.append('prominentImageIndex', prominentImageIndex);\n      formData.append('deleteImages', JSON.stringify(images.filter((img, i) => !previews.includes(img.url)).map(img => img.url)));\n      newImages.forEach(file => formData.append('images', file));\n\n      await axios.put(`/api/products/${productId}`, formData, {\n        headers: {\n          Authorization: token,\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n\n      setMessage('Product updated successfully! Redirecting...');\n      setTimeout(() => {\n        router.push(`/products/${productId}`);\n      }, 1500);\n    } catch (err) {\n      if (err.response?.status === 401) {\n        router.push('/login');\n        return;\n      }\n      setMessage(err.response?.data?.message || 'Failed to update product');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!confirm('Are you sure you want to delete this product?')) return;\n    setIsLoading(true);\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        router.push('/login');\n        return;\n      }\n      await axios.delete(`/api/products/${productId}`, {\n        headers: { Authorization: token }\n      });\n      setMessage('Product deleted successfully! Redirecting...');\n      setTimeout(() => {\n        router.push('/products');\n      }, 1500);\n    } catch (err) {\n      if (err.response?.status === 401) {\n        router.push('/login');\n        return;\n      }\n      setMessage(err.response?.data?.message || 'Failed to delete product');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 dark:bg-gray-900\">\n      <Navbar />\n      <div className=\"max-w-4xl mx-auto mt-10 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md\">\n      <h2 className=\"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-white\">Edit Product</h2>\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Product Images</label>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n            {previews.map((preview, index) => (\n              <div key={index} className=\"relative\">\n                <Image\n                  src={preview}\n                  alt={`Product image ${index + 1}`}\n                  width={200}\n                  height={200}\n                  className={`w-full h-32 object-cover rounded-lg ${\n                    prominentImageIndex === index ? 'ring-2 ring-blue-500' : ''\n                  }`}\n                  onClick={() => setProminentImageIndex(index)}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => handleDeleteImage(index)}\n                  className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\"\n                >\n                  <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n            ))}\n            {images.length + newImages.length < 5 && (\n              <div className=\"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center h-32\">\n                <label className=\"cursor-pointer\">\n                  <input\n                    type=\"file\"\n                    className=\"hidden\"\n                    accept=\"image/*\"\n                    multiple\n                    onChange={handleImageChange}\n                  />\n                  <svg className=\"h-8 w-8 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n                  </svg>\n                </label>\n              </div>\n            )}\n          </div>\n          <p className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n            Click an image to set it as prominent. Max 5 images.\n          </p>\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Product Name</label>\n          <input\n            type=\"text\"\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n            className=\"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            required\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Description</label>\n          <textarea\n            value={description}\n            onChange={(e) => setDescription(e.target.value)}\n            className=\"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            required\n            rows=\"4\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Price ($)</label>\n          <input\n            type=\"number\"\n            value={price}\n            onChange={(e) => setPrice(e.target.value)}\n            className=\"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            required\n            min=\"0.01\"\n            step=\"0.01\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Stock Quantity</label>\n          <input\n            type=\"number\"\n            value={stock}\n            onChange={(e) => setStock(e.target.value)}\n            className=\"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            required\n            min=\"0\"\n          />\n        </div>\n        <div className=\"flex space-x-4\">\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isLoading ? 'Updating...' : 'Update Product'}\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleDelete}\n            disabled={isLoading}\n            className=\"flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isLoading ? 'Deleting...' : 'Delete Product'}\n          </button>\n          <Link\n            href={`/products/${productId}`}\n            className=\"flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300 transition-colors text-center dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600\"\n          >\n            Cancel\n          </Link>\n        </div>\n      </form>\n      {message && (\n        <div className={`mt-4 p-4 rounded-lg ${\n          message.includes('successful') \n            ? 'bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-400' \n            : 'bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-400'\n        }`}>\n          {message}\n        </div>\n      )}\n    </div>\n    </div>\n    \n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}