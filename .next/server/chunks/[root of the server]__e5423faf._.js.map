{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Programming/NodeJs%20Learning/ecommerce-app/models/Product.js"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst productSchema = new mongoose.Schema({\n  name: String,\n  price: Number,\n  stock: Number,\n  description: String,\n  images: [{\n    url: String,\n    isProminent: { type: Boolean, default: false }\n  }]\n});\n\nexport default mongoose.models.Product || mongoose.model('Product', productSchema);"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC;IACxC,MAAM;IACN,OAAO;IACP,OAAO;IACP,aAAa;IACb,QAAQ;QAAC;YACP,KAAK;YACL,aAAa;gBAAE,MAAM;gBAAS,SAAS;YAAM;QAC/C;KAAE;AACJ;uCAEe,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Programming/NodeJs%20Learning/ecommerce-app/app/api/products/%5Bid%5D/route.js"],"sourcesContent":["import mongoose from 'mongoose';\nimport jwt from 'jsonwebtoken';\nimport { v2 as cloudinary } from 'cloudinary';\nimport Product from '../../../../models/Product';\n\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nconst authMiddleware = (req) => {\n  const token = req.headers.get('authorization');\n  if (!token) throw new Error('No token provided');\n  return jwt.verify(token, process.env.JWT_SECRET);\n};\n\nexport async function GET(req, { params }) {\n  try {\n    await mongoose.connect(process.env.MONGO_URI);\n    const product = await Product.findById(params.id);\n    if (!product) {\n      return new Response(JSON.stringify({ message: 'Product not found' }), { status: 404 });\n    }\n    return new Response(JSON.stringify(product), { status: 200 });\n  } catch (error) {\n    return new Response('Error fetching product: ' + error.message, { status: 500 });\n  }\n}\n\nexport async function PUT(req, { params }) {\n  try {\n    const user = authMiddleware(req);\n    if (user.role !== 'admin') {\n      return new Response('Admins only', { status: 403 });\n    }\n\n    const formData = await req.formData();\n    const name = formData.get('name');\n    const price = formData.get('price');\n    const stock = formData.get('stock');\n    const description = formData.get('description');\n    const prominentImageIndex = parseInt(formData.get('prominentImageIndex') || 0);\n    const deleteImages = JSON.parse(formData.get('deleteImages') || '[]');\n    const files = formData.getAll('images'); // New images\n\n    if (!name || !price || !stock || !description) {\n      return new Response('Missing required fields', { status: 400 });\n    }\n\n    const numericPrice = parseFloat(price);\n    const numericStock = parseInt(stock);\n    if (isNaN(numericPrice) || isNaN(numericStock)) {\n      return new Response('Invalid price or stock value', { status: 400 });\n    }\n\n    await mongoose.connect(process.env.MONGO_URI);\n    const product = await Product.findById(params.id);\n    if (!product) {\n      return new Response('Product not found', { status: 404 });\n    }\n\n    // Upload new images to Cloudinary\n    const imageUploads = files.map(async (file, index) => {\n      const arrayBuffer = await file.arrayBuffer();\n      const buffer = Buffer.from(arrayBuffer);\n      return new Promise((resolve, reject) => {\n        cloudinary.uploader.upload_stream(\n          { resource_type: 'image' },\n          (error, result) => {\n            if (error) reject(error);\n            else resolve({ url: result.secure_url, isProminent: false });\n          }\n        ).end(buffer);\n      });\n    });\n\n    const newImages = await Promise.all(imageUploads);\n\n    // Filter out deleted images\n    let existingImages = product.images.filter(img => !deleteImages.includes(img.url));\n\n    // Combine existing and new images\n    const allImages = [...existingImages, ...newImages];\n\n    // Set prominent image\n    if (allImages.length > 0) {\n      allImages.forEach((img, index) => {\n        img.isProminent = index === prominentImageIndex;\n      });\n    }\n\n    // Update product\n    product.name = name;\n    product.price = numericPrice;\n    product.stock = numericStock;\n    product.description = description;\n    product.images = allImages;\n\n    await product.save();\n    return new Response(JSON.stringify(product), { status: 200 });\n  } catch (error) {\n    console.error('Error updating product:', error);\n    return new Response('Error updating product: ' + error.message, { status: 400 });\n  }\n}\n\nexport async function DELETE(req, { params }) {\n  try {\n    const user = authMiddleware(req);\n    if (user.role !== 'admin') {\n      return new Response('Admins only', { status: 403 });\n    }\n    await mongoose.connect(process.env.MONGO_URI);\n    const product = await Product.findByIdAndDelete(params.id);\n    if (!product) {\n      return new Response('Product not found', { status: 404 });\n    }\n    return new Response('Product deleted successfully', { status: 200 });\n  } catch (error) {\n    return new Response('Error deleting product: ' + error.message, { status: 400 });\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}