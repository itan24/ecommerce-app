{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Programming/NodeJs%20Learning/ecommerce-app/models/Product.js"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst productSchema = new mongoose.Schema({\n  name: String,\n  price: Number,\n  stock: Number,\n  description: String,\n  images: [{\n    url: String,\n    isProminent: { type: Boolean, default: false }\n  }]\n});\n\nexport default mongoose.models.Product || mongoose.model('Product', productSchema);"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC;IACxC,MAAM;IACN,OAAO;IACP,OAAO;IACP,aAAa;IACb,QAAQ;QAAC;YACP,KAAK;YACL,aAAa;gBAAE,MAAM;gBAAS,SAAS;YAAM;QAC/C;KAAE;AACJ;uCAEe,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Programming/NodeJs%20Learning/ecommerce-app/app/api/products/route.js"],"sourcesContent":["import mongoose from 'mongoose';\nimport jwt from 'jsonwebtoken';\nimport { v2 as cloudinary } from 'cloudinary';\nimport Product from '../../../models/Product';\n\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nconst authMiddleware = (req) => {\n  const token = req.headers.get('authorization');\n  if (!token) throw new Error('No token provided');\n  return jwt.verify(token, process.env.JWT_SECRET);\n};\n\nexport async function GET(req) {\n  try {\n    await mongoose.connect(process.env.MONGO_URI);\n    const products = await Product.find();\n    return new Response(JSON.stringify(products), { status: 200 });\n  } catch (error) {\n    return new Response('Error fetching products: ' + error.message, { status: 500 });\n  }\n}\n\nexport async function POST(req) {\n  try {\n    const user = authMiddleware(req);\n    if (user.role !== 'admin') {\n      return new Response('Admins only', { status: 403 });\n    }\n\n    const formData = await req.formData();\n    const name = formData.get('name');\n    const price = formData.get('price');\n    const stock = formData.get('stock');\n    const description = formData.get('description');\n    const prominentImageIndex = parseInt(formData.get('prominentImageIndex') || 0);\n    const files = formData.getAll('images'); // Get uploaded images\n\n    if (!name || !price || !stock || !description) {\n      return new Response('Missing required fields', { status: 400 });\n    }\n\n    const numericPrice = parseFloat(price);\n    const numericStock = parseInt(stock);\n    if (isNaN(numericPrice) || isNaN(numericStock)) {\n      return new Response('Invalid price or stock value', { status: 400 });\n    }\n\n    // Upload images to Cloudinary\n    const imageUploads = files.map(async (file, index) => {\n      const arrayBuffer = await file.arrayBuffer();\n      const buffer = Buffer.from(arrayBuffer);\n      return new Promise((resolve, reject) => {\n        cloudinary.uploader.upload_stream(\n          { resource_type: 'image' },\n          (error, result) => {\n            if (error) reject(error);\n            else resolve({ url: result.secure_url, isProminent: index === prominentImageIndex });\n          }\n        ).end(buffer);\n      });\n    });\n\n    const images = await Promise.all(imageUploads);\n\n    await mongoose.connect(process.env.MONGO_URI);\n    const product = new Product({\n      name,\n      price: numericPrice,\n      stock: numericStock,\n      description,\n      images,\n    });\n\n    await product.save();\n    return new Response(JSON.stringify(product), { status: 201 });\n  } catch (error) {\n    console.error('Error adding product:', error);\n    return new Response('Error adding product: ' + error.message, { status: 400 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,0IAAA,CAAA,KAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;AAEA,MAAM,iBAAiB,CAAC;IACtB,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC;IAC9B,IAAI,CAAC,OAAO,MAAM,IAAI,MAAM;IAC5B,OAAO,uIAAA,CAAA,UAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;AACjD;AAEO,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,SAAS;QAC5C,MAAM,WAAW,MAAM,mHAAA,CAAA,UAAO,CAAC,IAAI;QACnC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,WAAW;YAAE,QAAQ;QAAI;IAC9D,EAAE,OAAO,OAAO;QACd,OAAO,IAAI,SAAS,8BAA8B,MAAM,OAAO,EAAE;YAAE,QAAQ;QAAI;IACjF;AACF;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,MAAM,OAAO,eAAe;QAC5B,IAAI,KAAK,IAAI,KAAK,SAAS;YACzB,OAAO,IAAI,SAAS,eAAe;gBAAE,QAAQ;YAAI;QACnD;QAEA,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,QAAQ,SAAS,GAAG,CAAC;QAC3B,MAAM,QAAQ,SAAS,GAAG,CAAC;QAC3B,MAAM,cAAc,SAAS,GAAG,CAAC;QACjC,MAAM,sBAAsB,SAAS,SAAS,GAAG,CAAC,0BAA0B;QAC5E,MAAM,QAAQ,SAAS,MAAM,CAAC,WAAW,sBAAsB;QAE/D,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,aAAa;YAC7C,OAAO,IAAI,SAAS,2BAA2B;gBAAE,QAAQ;YAAI;QAC/D;QAEA,MAAM,eAAe,WAAW;QAChC,MAAM,eAAe,SAAS;QAC9B,IAAI,MAAM,iBAAiB,MAAM,eAAe;YAC9C,OAAO,IAAI,SAAS,gCAAgC;gBAAE,QAAQ;YAAI;QACpE;QAEA,8BAA8B;QAC9B,MAAM,eAAe,MAAM,GAAG,CAAC,OAAO,MAAM;YAC1C,MAAM,cAAc,MAAM,KAAK,WAAW;YAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;YAC3B,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,0IAAA,CAAA,KAAU,CAAC,QAAQ,CAAC,aAAa,CAC/B;oBAAE,eAAe;gBAAQ,GACzB,CAAC,OAAO;oBACN,IAAI,OAAO,OAAO;yBACb,QAAQ;wBAAE,KAAK,OAAO,UAAU;wBAAE,aAAa,UAAU;oBAAoB;gBACpF,GACA,GAAG,CAAC;YACR;QACF;QAEA,MAAM,SAAS,MAAM,QAAQ,GAAG,CAAC;QAEjC,MAAM,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,SAAS;QAC5C,MAAM,UAAU,IAAI,mHAAA,CAAA,UAAO,CAAC;YAC1B;YACA,OAAO;YACP,OAAO;YACP;YACA;QACF;QAEA,MAAM,QAAQ,IAAI;QAClB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,UAAU;YAAE,QAAQ;QAAI;IAC7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,IAAI,SAAS,2BAA2B,MAAM,OAAO,EAAE;YAAE,QAAQ;QAAI;IAC9E;AACF","debugId":null}}]
}